# أبشر سفر - تحليل المشروع والبيانات
# Absher Safar - Project Analysis & Data Documentation

---

## 📊 البيانات المستخدمة (Data Used)

### الفكرة الأساسية للمشروع

**أبشر سفر** هو حل مبتكر يهدف إلى تمكين المواطنين الممنوعين من السفر بسبب مديونيات مسجلة في نظام **ناجز** من الحصول على تصاريح سفر مؤقتة، مع ضمان حقوق الدائنين من خلال آلية سداد تلقائي.

---

### 1️⃣ مصادر البيانات الفعلية

#### أ) بيانات من منصة أبشر (Absher Platform Data)
| نوع البيانات | المصدر | الاستخدام |
|-------------|--------|----------|
| معلومات الهوية الوطنية | النفاذ الوطني الموحد | التحقق من هوية المستخدم |
| حالة حظر السفر | نظام أبشر | التحقق من وجود منع سفر |
| سجل السفر السابق | نظام أبشر | تقييم الالتزام بالعودة |

#### ب) بيانات من منصة ناجز (Najiz Platform Data)
| نوع البيانات | المصدر | الاستخدام |
|-------------|--------|----------|
| تفاصيل المديونية | سجلات ناجز القضائية | حساب إجمالي الدين |
| معلومات الدائنين | قاعدة بيانات ناجز | إرسال طلبات الموافقة |
| الأحكام القضائية | النظام القضائي | التحقق من نوع المديونية |

#### ج) بيانات المعاملات المالية
| نوع البيانات | المصدر | الاستخدام |
|-------------|--------|----------|
| رصيد المحفظة | نظام سداد/مدى | التحقق من الضمان المالي |
| سجل المدفوعات | البنوك المعتمدة | متابعة السداد اليومي |
| حالة التحويلات | شبكة المدفوعات السعودية | تأكيد عمليات الخصم |

#### د) بيانات الضامن
| نوع البيانات | المصدر | الاستخدام |
|-------------|--------|----------|
| الأهلية المالية | سمة/نظام التصنيف الائتماني | التحقق من قدرة الضامن |
| العلاقة بالمدين | السجل المدني | التحقق من صلة القرابة |
| سجل الضمانات السابقة | قاعدة البيانات الداخلية | تقييم المخاطر |

---

### 2️⃣ معالجة وتنظيف البيانات

#### أ) التحقق والتصديق (Validation)
```
┌─────────────────────────────────────────────────────────────┐
│                    خطوات التحقق من البيانات                 │
├─────────────────────────────────────────────────────────────┤
│ 1. التحقق من صحة رقم الهوية (10 أرقام + خوارزمية Luhn)     │
│ 2. مطابقة البيانات مع السجل المدني                          │
│ 3. التحقق من حالة حظر السفر في الوقت الفعلي                │
│ 4. التأكد من صحة مبالغ المديونية من ناجز                    │
│ 5. التحقق من رصيد المحفظة قبل إصدار التصريح                 │
└─────────────────────────────────────────────────────────────┘
```

#### ب) حسابات البيانات المالية
```
المعادلات المستخدمة:
─────────────────────
• الخصم اليومي = إجمالي المديونية × نسبة الخصم اليومي
• الضمان المطلوب = الخصم اليومي × عدد أيام السفر × معامل المخاطر
• إجمالي المبلغ المحجوز = الضمان المطلوب + هامش الأمان (10%)
```

#### ج) تشفير البيانات الحساسة
- تشفير AES-256 للبيانات المالية
- تجزئة SHA-256 لكلمات المرور
- TLS 1.3 لنقل البيانات
- إخفاء جزئي للأرقام الحساسة (Masking)

---

## 🔧 التقنيات المستخدمة (Technologies Used)

### ☑️ تكامل API مع منصة أبشر

**الوصف الفعلي:**
التكامل مع منصة أبشر يتطلب الحصول على اعتماد رسمي من وزارة الداخلية السعودية. يتم ذلك عبر:

1. **بوابة المطورين (Absher Developer Portal)**
   - التسجيل كمزود خدمة معتمد
   - الحصول على مفاتيح API
   - الالتزام بمعايير الأمان الحكومية

2. **نقاط الاتصال المطلوبة (Required Endpoints)**
   ```
   ┌────────────────────────────────────────────────────┐
   │ GET  /api/v1/citizen/travel-ban-status            │
   │ POST /api/v1/permits/temporary-travel             │
   │ GET  /api/v1/permits/{permitId}/verify            │
   │ POST /api/v1/notifications/send                   │
   └────────────────────────────────────────────────────┘
   ```

3. **معايير الأمان المطلوبة**
   - OAuth 2.0 للمصادقة
   - شهادات SSL من جهات معتمدة
   - تسجيل جميع العمليات (Audit Logging)
   - استضافة داخل المملكة

---

### ☑️ محرك سداد يومي تلقائي

**آلية العمل الفعلية:**

```
┌─────────────────────────────────────────────────────────────────┐
│                      دورة السداد اليومي                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐  │
│  │ الساعة   │───▶│ التحقق   │───▶│  الخصم   │───▶│ التحويل  │  │
│  │ 00:00    │    │ من الرصيد│    │ التلقائي │    │ للدائن   │  │
│  └──────────┘    └──────────┘    └──────────┘    └──────────┘  │
│                                                                 │
│  في حالة عدم كفاية الرصيد:                                      │
│  ┌──────────┐    ┌──────────┐    ┌──────────┐                  │
│  │ إشعار    │───▶│ مهلة 24  │───▶│ إلغاء    │                  │
│  │ المسافر  │    │ ساعة     │    │ التصريح  │                  │
│  └──────────┘    └──────────┘    └──────────┘                  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

**التكامل المطلوب:**
- نظام سداد للمدفوعات الحكومية
- شبكة مدى للخصم المباشر
- البنوك السعودية المعتمدة

---

### ☑️ لوحة تحكم للدائن والمدين

**لوحة المدين (المسافر):**
```
┌─────────────────────────────────────────────────────┐
│                    لوحة المدين                       │
├─────────────────────────────────────────────────────┤
│ • عرض إجمالي المديونية المسجلة                      │
│ • تقديم طلبات سفر جديدة                             │
│ • متابعة حالة الطلبات (قيد المراجعة/موافق/مرفوض)   │
│ • إدارة المحفظة الإلكترونية                         │
│ • عرض جدول السداد اليومي                           │
│ • استعراض التصاريح الصادرة                          │
│ • تحميل وطباعة التصاريح                             │
└─────────────────────────────────────────────────────┘
```

**لوحة الضامن/الدائن:**
```
┌─────────────────────────────────────────────────────┐
│                 لوحة الضامن/الدائن                   │
├─────────────────────────────────────────────────────┤
│ • استلام إشعارات طلبات الضمان                       │
│ • مراجعة تفاصيل الطلبات                             │
│ • الموافقة أو الرفض مع إبداء الأسباب                │
│ • متابعة حالة السداد اليومي                         │
│ • تلقي تقارير دورية                                 │
│ • تنبيهات عند تأخر السداد                           │
└─────────────────────────────────────────────────────┘
```

---

### ☑️ تنبيهات وإشعارات ذكية

**قنوات الإشعارات:**
| القناة | نوع الإشعار | التوقيت |
|--------|------------|---------|
| SMS | طلب ضمان جديد | فوري |
| إشعار التطبيق | تحديث حالة الطلب | فوري |
| البريد الإلكتروني | تقارير السداد | يومي |
| SMS | تذكير العودة | قبل 48 ساعة |
| اتصال هاتفي | تأخر عن موعد العودة | بعد 24 ساعة |

**سيناريوهات الإشعارات:**
```
1. عند تقديم طلب سفر ──▶ إشعار للضامن والدائن
2. عند موافقة الضامن ──▶ إشعار للمدين والدائن
3. عند موافقة الدائن ──▶ إشعار للمدين لشحن المحفظة
4. عند إصدار التصريح ──▶ إشعار لجميع الأطراف
5. يومياً بعد الخصم ──▶ إشعار للمدين والدائن
6. قبل انتهاء التصريح ──▶ تذكير بموعد العودة
7. عند انتهاء التصريح ──▶ تأكيد العودة أو تصعيد
```

---

### ☑️ خوارزمية تقييم مخاطر الالتزام

**عوامل تقييم المخاطر:**

```
┌─────────────────────────────────────────────────────────────────┐
│                    معادلة تقييم المخاطر                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  نقاط المخاطر = Σ (عامل × وزن)                                  │
│                                                                 │
│  العوامل:                                                        │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │ 1. نسبة المديونية إلى الدخل        │ الوزن: 25%        │    │
│  │ 2. سجل السداد السابق              │ الوزن: 20%        │    │
│  │ 3. عدد مرات السفر السابقة         │ الوزن: 15%        │    │
│  │ 4. نسبة الالتزام بمواعيد العودة    │ الوزن: 25%        │    │
│  │ 5. قوة الضامن المالية            │ الوزن: 15%        │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                 │
│  مستويات المخاطر:                                               │
│  • منخفض (0-40): معامل ضمان 1.2x                               │
│  • متوسط (41-70): معامل ضمان 1.5x                              │
│  • مرتفع (71-100): معامل ضمان 2.0x أو رفض الطلب                │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

**مخرجات الخوارزمية:**
1. **درجة المخاطر** (0-100)
2. **مستوى المخاطر** (منخفض/متوسط/مرتفع)
3. **معامل الضمان المطلوب**
4. **توصية** (موافقة/موافقة بشروط/رفض)
5. **شروط إضافية** (إن وجدت)

---

## 📱 مسار العملية الكامل (Complete Process Flow)

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          مسار أبشر سفر الكامل                            │
└─────────────────────────────────────────────────────────────────────────┘

المرحلة 1: تقديم الطلب
═══════════════════════
     ┌──────────────┐
     │ دخول المدين  │
     │ عبر أبشر    │
     └──────┬───────┘
            │
            ▼
     ┌──────────────┐
     │ التحقق من   │
     │ حظر السفر   │
     └──────┬───────┘
            │
            ▼
     ┌──────────────┐
     │ عرض تفاصيل  │
     │ المديونية   │
     └──────┬───────┘
            │
            ▼
     ┌──────────────┐
     │ إدخال بيانات │
     │ الرحلة      │
     └──────┬───────┘
            │
            ▼

المرحلة 2: الموافقات
═══════════════════
     ┌──────────────┐
     │ إرسال طلب   │
     │ للضامن      │
     └──────┬───────┘
            │
     ┌──────┴──────┐
     │             │
     ▼             ▼
┌─────────┐   ┌─────────┐
│ موافقة  │   │  رفض   │──▶ انتهاء
└────┬────┘   └─────────┘
     │
     ▼
     ┌──────────────┐
     │ إرسال طلب   │
     │ للدائن      │
     └──────┬───────┘
            │
     ┌──────┴──────┐
     │             │
     ▼             ▼
┌─────────┐   ┌─────────┐
│ موافقة  │   │  رفض   │──▶ انتهاء
└────┬────┘   └─────────┘
     │
     ▼

المرحلة 3: الضمان المالي
══════════════════════
     ┌──────────────┐
     │ حساب مبلغ   │
     │ الضمان      │
     └──────┬───────┘
            │
            ▼
     ┌──────────────┐
     │ شحن المحفظة │
     │ الإلكترونية │
     └──────┬───────┘
            │
            ▼
     ┌──────────────┐
     │ التحقق من   │
     │ الرصيد      │
     └──────┬───────┘
            │
            ▼

المرحلة 4: إصدار التصريح
═══════════════════════
     ┌──────────────┐
     │ إصدار تصريح │
     │ السفر المؤقت│
     └──────┬───────┘
            │
            ▼
     ┌──────────────┐
     │ توليد رمز   │
     │ QR للتحقق   │
     └──────┬───────┘
            │
            ▼
     ┌──────────────┐
     │ رفع حظر     │
     │ السفر مؤقتاً │
     └──────┬───────┘
            │
            ▼

المرحلة 5: فترة السفر
═══════════════════
     ┌──────────────┐
     │ بدء السداد  │
     │ اليومي      │
     └──────┬───────┘
            │
            ▼
     ┌──────────────┐
     │ مراقبة      │
     │ الالتزام    │
     └──────┬───────┘
            │
            ▼
     ┌──────────────┐
     │ تذكير       │
     │ بالعودة     │
     └──────┬───────┘
            │
            ▼

المرحلة 6: الإغلاق
═════════════════
     ┌──────────────┐
     │ تأكيد العودة │
     │ للمملكة     │
     └──────┬───────┘
            │
     ┌──────┴──────┐
     │             │
     ▼             ▼
┌─────────┐   ┌─────────┐
│  عودة   │   │ تأخر   │
│ في الموعد│   │ العودة │
└────┬────┘   └────┬────┘
     │             │
     ▼             ▼
┌─────────┐   ┌─────────┐
│ إرجاع   │   │ مصادرة │
│ الفائض  │   │ الضمان │
└─────────┘   └─────────┘
```

---

## 🏗️ البنية التقنية المقترحة

```
┌─────────────────────────────────────────────────────────────────┐
│                      البنية التقنية                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  الواجهة الأمامية (Frontend)                                    │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │ React.js │ Vite │ React Router │ Lucide Icons           │    │
│  └─────────────────────────────────────────────────────────┘    │
│                           │                                     │
│                           ▼                                     │
│  الخدمات الخلفية (Backend)                                      │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │ Node.js/Express │ REST API │ JWT Auth │ Rate Limiting   │    │
│  └─────────────────────────────────────────────────────────┘    │
│                           │                                     │
│                           ▼                                     │
│  قاعدة البيانات (Database)                                      │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │ PostgreSQL │ Redis (Cache) │ S3 (Documents)             │    │
│  └─────────────────────────────────────────────────────────┘    │
│                           │                                     │
│                           ▼                                     │
│  التكاملات الخارجية (External Integrations)                     │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │ أبشر API │ ناجز API │ سداد │ مدى │ النفاذ الموحد        │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 📋 المتطلبات للتطبيق الفعلي

### اعتمادات مطلوبة:
1. ✅ اعتماد من وزارة الداخلية للتكامل مع أبشر
2. ✅ اعتماد من وزارة العدل للتكامل مع ناجز
3. ✅ ترخيص من مؤسسة النقد للمعاملات المالية
4. ✅ شهادة الامتثال للأمن السيبراني (NCA)

### البنية التحتية:
1. ✅ استضافة سحابية داخل المملكة (AWS Saudi / STC Cloud)
2. ✅ شهادات SSL معتمدة
3. ✅ نظام نسخ احتياطي
4. ✅ مركز بيانات احتياطي (DR)

---

**تاريخ الإعداد:** ديسمبر 2024
**الإصدار:** 1.0





